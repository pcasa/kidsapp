document.observe("click",function(e,t){if(t=e.findElement("form a.add_nested_fields")){var n=t.readAttribute("data-association"),r=$(t.readAttribute("data-blueprint-id")),s=r.readAttribute("data-blueprint"),o=(t.getOffsetParent(".fields").firstDescendant().readAttribute("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(o){var u=o.match(/[a-z_]+_attributes/g)||[],a=o.match(/[0-9]+/g)||[];for(i=0;i<u.length;i++)a[i]&&(s=s.replace(new RegExp("(_"+u[i]+")_.+?_","g"),"$1_"+a[i]+"_"),s=s.replace(new RegExp("(\\["+u[i]+"\\])\\[.+?\\]","g"),"$1["+a[i]+"]"))}var f=new RegExp("new_"+n,"g"),l=(new Date).getTime();s=s.replace(f,l);var c=t.insert({before:s});return c.fire("nested:fieldAdded",{field:c}),c.fire("nested:fieldAdded:"+n,{field:c}),!1}}),document.observe("click",function(e,t){if(t=e.findElement("form a.remove_nested_fields")){var n=t.previous(0),r=t.readAttribute("data-association");n&&(n.value="1");var i=t.up(".fields").hide();return i.fire("nested:fieldRemoved",{field:i}),i.fire("nested:fieldRemoved:"+r,{field:i}),!1}});